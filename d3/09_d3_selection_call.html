<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
          .box {
            width: 50px;
            height: 50px;
            margin: 5px;
            display: inline-block;
            color: white;
            padding: 5px;
          }
          .pink-box {
            background-color: pink;
          }
          .aqua-box {
            background-color: lightblue;
          }
        </style>
    </head>
    <body>
        <script src="https://d3js.org/d3.v7.min.js"></script>
          <button onclick="addElementsWithCall()">Insert Elements</button>
          
          <div id="callBoxes" class="container">
              <div class="box pink-box"></div>
              <div class="box pink-box"></div>
              <div class="box pink-box"></div>
          </div>

          <script>
            function addElements(selection, n) {
              let nodeList = selection.nodes();
              for (let i = 0; i < nodeList.length; i++) {
                for (let j = 0; j < n; j++) {
                  let newElm = d3.create("div").node();
                  newElm.className = "box aqua-box";
                  nodeList[i].parentNode.insertBefore(newElm, nodeList[i]);
                }
              }
            }
            
            function addElementsWithCall() {
              /*
                # selection.call(f, [, arguments...])
                  - selection.call이 실행되면 인수로 전달된 function을 실행합니다. 
                  - 여러 selection에 실행해야 하는 일련의 처리가 있는 경우 유용합니다. 
                  - 호출된 selection을 반환하므로 체이닝으로 사용할 수 있습니다. 
                  - 매개변수
                    - 첫번째 매개변수 : [필수] 함수
                    - 두번째부터 추가되는 매개변수 : [선택] 함수 실행 시 이 매개변수 값들이 함수에 전달됩니다. 
              */

              d3.selectAll('#callBoxes > div')
                .call(addElements, 1);
            }
            </script> 
    </body>
</html>